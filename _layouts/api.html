---
layout: base
---
{%- assign branch = page.branch -%}
{%- assign refs = site.data.refindex | where: "branch", branch -%}
{%- assign branches = site.data.branchindex -%}
{%- assign categories = refs | map: "type" | uniq | sort -%}
{%- assign clean_ref = page.ref | remove: '.' -%}

{%- if page.type == "Extension" -%}
	{%- assign ref = site.data.extensions[clean_ref] -%}
{%- else -%}
	{%- assign ref = site.data.ref[page.branch][clean_ref] -%}
{%- endif -%}

{%- assign api_index_exclude = false -%}
{%- if page.url contains "/ref/alpha/" or page.url contains "/ref/beta/" or page.url contains "/ref/stable/" -%}
  {%- assign api_index_exclude = true -%}
{%- endif -%}
{%- if ref.info.language == "" or ref.info.language == nil -%}
  {%- assign api_index_exclude = true -%}
{%- endif -%}
{%- if page.pagefind_exclude -%}
  {%- assign api_index_exclude = true -%}
{%- endif -%}

{%- unless api_index_exclude -%}
<!-- Pagefind metadata and filters for API reference -->
<div style="display: none;" data-pagefind-filter="section">API {{ref.info.language}}</div>
<div style="display: none;" data-pagefind-meta="section">API {{ref.info.language}}</div>
{%- endunless -%}

{%- if page.url contains branch -%}
	{%- assign page_url = page.url | replace: branch, "BRANCH" -%}
{%- else -%}
	{%- assign page_url = page.url | replace: "ref/", "ref/BRANCH/" -%}
{%- endif -%}

{%- if api_index_exclude -%}
<div id="page" class="lightest dark:dark" style="position: relative;" data-pagefind-ignore>
{%- else -%}
<div id="page" class="lightest dark:dark" style="position: relative;">
{%- endif -%}
	<div id="pagecontent">
		<div class="apimenu sidemenu dark:dark">
			<p><a href="/learn"><img class="logo-hor-classic-160" src="/images/logo/defold/logo_with_text/logo-hor-classic-dark-160.png"/></a></p>
			<form action="/search">
				<input id="search" name="q" type="text" placeholder="Search..."/>
			</form>
			<hr>
			<ul class="nobullet">
				{% comment %}Iterate over "Defold C", "Defold Lua", Defold C++" etc{% endcomment %}
				{%- for category in categories -%}
					{%- assign categoryrefs = refs | where: "type", category | sort_natural: "namespace" -%}
					{%- assign clean_category = category | remove: ' ' | replace: "C++", "cpp" | downcase -%}

					{%- assign checked = "" -%}
					{%- for r in categoryrefs -%}
						{%- assign url = r.url -%}
						{%- if page.url contains url -%}
							{%- assign checked = "checked" -%}
						{%- endif -%}
					{%- endfor -%}

				<input id="collapsible_{{ category }}" class="toggle" type="checkbox" {{ checked }}/>
				<label for="collapsible_{{ category }}" class="togglelabel">{{ category }}</label>
				<ul class="nobullet">
					<li style="padding-bottom: 0px;"><a href="/ref/{{page.branch}}/overview_{{clean_category}}" style="text-decoration: none;">Overview</a></li>

					{%- assign namespaces = categoryrefs | map: "namespace" | uniq | sort_natural -%}
					{%- for ns in namespaces -%}
						{%- assign namespacerefs = categoryrefs | where: "namespace", ns | sort_natural: "file" -%}
						{%- if namespacerefs.size > 1 -%}
							<label class="togglelabel">{{ ns }}</label>
							<ul class="nobullet">
							{%- for r in namespacerefs -%}
								{%- assign textstyle = "text-decoration: none;" -%}
								{%- if page.url contains r.url -%}
									{%- assign textstyle = "font-weight: bolder; font-style: italic; text-decoration: none;" -%}
								{%- endif -%}
								<li id="{{ r.namespace }}" style="padding-bottom: 0px;"><a href="{{ r.url }}" style="{{ textstyle }}">{%- if r.language == "C++" or r.language == "C" -%}{{r.file}}{%- endif -%}{%- if r.type == "Extension" -%}{{r.name}}{%- endif -%}</a></li>
							{%- endfor -%}
							</ul>
						{%- else -%}
							{%- for r in namespacerefs -%}
								{%- assign textstyle = "text-decoration: none;" -%}
								{%- if page.url contains r.url -%}
									{%- assign textstyle = "font-weight: bolder; font-style: italic; text-decoration: none;" -%}
								{%- endif -%}
								<li id="{{ r.namespace }}" style="padding-bottom: 0px;"><a href="{{ r.url }}" style="{{ textstyle }}">{{ r.namespace }}{%- if r.language == "C++" or r.language == "C" -%}&nbsp;-&nbsp;({{r.file}}){%- endif -%}{%- if r.type == "Extension" -%}&nbsp;-&nbsp;({{r.name}}){%- endif -%}</a></li>
							{%- endfor -%}
						{%- endif -%}
					{%- endfor -%}
				</ul>
				{%- endfor -%}

				<input id="branch" class="toggle" type="checkbox" checked/>
				<label for="branch" class="togglelabel">Version</label>
				<ul class="nobullet">
					{%- for b in branches -%}
						{%- assign textstyle = "text-decoration: none;" -%}
						{%- if page.branch == b -%}
							{%- assign textstyle = "font-weight: bolder; font-style: italic; text-decoration: none;" -%}
						{%- endif -%}
					<li style="padding-left: 2rem; padding-bottom: 0px;"><a href="{{ page_url | replace: 'BRANCH', b }}" style="{{ textstyle }}">{{ b }}</a></li>
					{%- endfor -%}
				</ul>
			</ul>

		</div>

		<div class="apicontent lightest dark:dark" data-pagefind-body>
			<div class="dropdownmenu">
				<p>
					<a href="/learn"><img src="/images/logo/defold/logo_with_text/logo-hor-classic-dark-160.png"/></a>
				</p>
				<form action="/search">
					<input id="search" name="q" type="text" placeholder="Search..."/>
				</form>
			</div>
			<select class="dropdownmenu" onchange="location = this.value;">
				{%- for r in refs -%}
				<option value="{{ r.url }}">{{ r.namespace }}{%- if r.type == "Extension" -%}&nbsp;-&nbsp;({{r.name}}){%- endif -%}</option>
				{%- endfor -%}
			</select>
			<select class="dropdownmenu" onchange="location = this.value;">
				{%- for b in branches -%}
				<option value="{{ page_url | replace: 'BRANCH', b }}">{{ b }}</option>
				{%- endfor -%}
			</select>


			{%- if page.ref == "overview" -%}
				<h1>API Overview</h1>
				{%- assign typerefs = refs | where: "type", page.type | natural_sort: "namespace" -%}
				<ul class="nobullet">
				{%- for r in typerefs -%}
					<li>
					{%- assign index = r.filename | remove: '.' -%}
					{%- if page.type == "Extension" -%}
						{%- assign ref = site.data.extensions[index] -%}
					{%- else -%}
						{%- assign ref = site.data.ref[page.branch][index] -%}
					{%- endif -%}

					<p><a href="{{r.url}}">{{ r.namespace }}</a>{%- if r.language == "C++" -%}&nbsp;({{r.file}}){%- endif -%}{%- if r.type == "Extension" -%}&nbsp;({{r.name}}){%- endif -%}&nbsp;{{ ref.info.brief }}</p>
					</li>
				{%- endfor -%}
				</ul>
			{%- elsif ref.info.language == "C++" -%}
				{%- include api_c.html ref=ref -%}
			{%- elsif ref.info.language == "Lua" -%}
				{%- include api_lua.html ref=ref -%}
			{%- else -%}
				{%- include api_c.html ref=ref -%}
			{%- endif -%}
		</div>
	</div>
</div>

{%- include marksearchhits.html div="apicontent" -%}
{%- include copy-icon-for-code-snippets.html -%}
